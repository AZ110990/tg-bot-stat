import os
import random
import telebot
from telebot import types
from datetime import datetime
from data_manager import *

from dotenv import load_dotenv
load_dotenv()
bot = telebot.TeleBot(os.getenv('TOKEN_BOT_API_TEST'))

class Dialog:
    mode = None
    data = None

dialog = Dialog()
user_data = {}
# bot = telebot.TeleBot(os.environ.get('TOKEN_BOT_API_TEST'))

#------------------------list of commands for bot menu (left side menu)------------------------------------------------
commands = {
        "start": "–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é –±–æ—Ç–∞",
        "data": "–°–±–æ—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏-—Ñ–∏–≥–∏—Å—Ç–∏–∫–∏",
    }
# --------------------- bot ---------------------
@bot.message_handler(commands=['start'])
def start(message):
    command_list = [types.BotCommand(key, value) for key, value in commands.items()]
    keyboard = types.InlineKeyboardMarkup()
    keyboard.row(
        types.InlineKeyboardButton('–†–∞–±–æ—Ç–∞ —Å –î–∞–Ω–Ω—ã–º–∏', callback_data='data'),
        types.InlineKeyboardButton('–ò–≥—Ä—ã', callback_data='games')
    )
    bot.set_my_commands(command_list, scope=types.BotCommandScopeChat(chat_id=message.chat.id))
    bot.set_chat_menu_button(menu_button=types.MenuButtonCommands(), chat_id=message.chat.id)
    bot.send_message(chat_id=message.chat.id, text="–ü—Ä–∏–≤–µ—Ç! –ß—Ç–æ –±—ã —Ç—ã —Ö–æ—Ç–µ–ª —Å–¥–µ–ª–∞—Ç—å?", reply_markup=keyboard)
    #
    # markup = telebot.types.InlineKeyboardMarkup()
    # btn1 = telebot.types.InlineKeyboardButton('–†–∞–±–æ—Ç–∞ —Å –¥–∞–Ω–Ω—ã–º–∏', callback_data='work_with_data')
    # btn2 = telebot.types.InlineKeyboardButton('–ò–≥—Ä—ã', callback_data='games')
    # markup.add(btn1, btn2)
    # bot.send_message(chat_id=message.chat.id, text='–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:', reply_markup=markup)

@bot.message_handler(content_types=['text'])
def handle_message(message):
    if dialog.mode == "eggs":
        dialog.data = int(message.text)
        bot.send_message(chat_id=message.chat.id, text=f'–í—ã –≤–≤–µ–ª–∏: {dialog.data}')
        dialog.mode = None
    else:
        bot.send_message(chat_id=message.chat.id, text='–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É –∏–∑ –ú–µ–Ω—é')


@bot.message_handler(commands=['data'])
def work_with_data_menu(message):
    keyboard = types.InlineKeyboardMarkup()
    keyboard.row(
        types.InlineKeyboardButton('–Ø–π—Ü–∞ ü•ö', callback_data='eggs'),
        types.InlineKeyboardButton('–°—Ä–µ–¥–Ω–µ–µ', callback_data='average')
    )
    # bot.send_message(chat_id=message.chat.id, text='–í—ã –≤—ã–±—Ä–∞–ª–∏ —Ä–∞–±–æ—Ç—É —Å –¥–∞–Ω–Ω—ã–º–∏. –ß—Ç–æ —Ö–æ—Ç–∏—Ç–µ —Å–¥–µ–ª–∞—Ç—å?',
    #                  reply_markup=keyboard)
    bot.send_message(chat_id=message.chat.id, text="–ü—Ä–∏–≤–µ—Ç! –ß—Ç–æ –±—ã —Ç—ã —Ö–æ—Ç–µ–ª —Å–¥–µ–ª–∞—Ç—å?", reply_markup=keyboard)
#
# @bot.callback_query_handler(func=lambda call: call.data == 'data')
# def work_with_data(call):
#     keyboard = types.InlineKeyboardMarkup()
#     keyboard.row(
#         types.InlineKeyboardButton('–Ø–π—Ü–∞ ü•ö', callback_data='eggs'),
#         types.InlineKeyboardButton('–°—Ä–µ–¥–Ω–µ–µ', callback_data='average')
#     )
#     bot.edit_message_text(chat_id=call.message.chat.id, message_id=call.message.message_id,
#                           text='–í—ã –≤—ã–±—Ä–∞–ª–∏ —Ä–∞–±–æ—Ç—É —Å –¥–∞–Ω–Ω—ã–º–∏. –ß—Ç–æ —Ö–æ—Ç–∏—Ç–µ —Å–¥–µ–ª–∞—Ç—å?:',
#                           reply_markup=keyboard)
#
#
# @bot.message_handler(content_types=['text'])
# def unknown(message):
#     if message.text.startswith('/'):
#         bot.send_message(chat_id=message.chat.id, text="–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞.")
#
# # @bot.callback_query_handler(func=lambda call: True)
# # def button_handler(call):
# #     bot.answer_callback_query(callback_query_id=call.id)
# #     if call.data == "data":
# #         work_with_data(call.message)
# #     elif call.data == "eggs":
# #         dialog.mode = "eggs"
# #         bot.send_message(chat_id=call.message.chat.id, text='–ù–∞–ø–∏—à–∏—Ç–µ —á–∏—Å–ª–æ —è–∏—Ü:')
# #     elif call.data == "average":
# #         get_data(call.message)
# #     elif call.data == "games":
# #         bot.send_message(chat_id=call.message.chat.id, text='–≠—Ç–∞ —á–∞—Å—Ç—å –µ—â–µ üöß üèó üöß')
# #     else:
# #         bot.send_message(chat_id=call.message.chat.id, text='–¢–∞–∫–æ–≥–æ –º—ã –µ—â–µ –Ω–µ –ø—Ä–æ—Ö–æ–¥–∏–ª–∏. –í–æ—Å–ø–æ–ª—å–∑—É–π—Ç–µ—Å—å –º–µ–Ω—é')
#
# @bot.callback_query_handler(func=lambda call: call.data == 'eggs')
# def work_with_data(call):
#     bot.send_message(chat_id=call.message.chat.id, text='–ù–∞–ø–∏—à–∏—Ç–µ —á–∏—Å–ª–æ:')
#     bot.register_next_step_handler(call.message, save_data)
#
# # –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
# def save_data(message):
#     user_id = message.chat.id
#     user_data[user_id] = int(message.text)
#     bot.send_message(chat_id=message.chat.id, text=f'–î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã: {user_data[user_id]}')
#
# @bot.callback_query_handler(func=lambda call: call.data == 'average')
# def get_data(call):
#     pass

# ---------------- local testing ----------------
if __name__ == '__main__':
    bot.infinity_polling()
